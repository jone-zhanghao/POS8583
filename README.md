# POS银联

### 报文头

##### 报文头的基本组成
域         域名                长度（单位：Byte）

Field1  头长度（Header Length）  1

Field2  头标识和版本号（Header Flag and Version）  1

Field3  整个报文长度（Total Message Length）  4

Field4  目的 ID（Destination ID）  11

Field5  源 ID（Source ID）  11

Field6  保留使用（Reserved for Use）  3

Field7  批次号（Batch Number）  1

Field8  交易信息（Transaction Information）  8

Field9  用户信息（User Information）  1

Field10  拒绝码（Reject Code）  5


共占46个字节。所有域都为必填域。
在入网机构产生的报文头中**拒绝码**域填“00000”，而当CUPS在检查中发现报文语法错误或报文结构错误时会将错误位置和错误原因填入该域，并将原始报文头和报文内容一起回应给报文的提出方，以
通知报文的提出方报文出错，报文的提出方可进行相关处理。入网机构不能产生非全0的拒绝码域，但
是它可能将收到这类拒绝码域。因此，入网机构产生的报文头和CUPS在未发现报文错误时产生的报文应
正常输出报文结构
报文头  报文类别码  位图  数据元区

异常输出报文结构
新增报文头（拒绝码标识错误位置和原因）   原始报文头（拒绝码为 00000）   报文类别码  位图  数据元区


### 报文类型标识符

Message Type ID

##### 单信息交易报文

0100/0110  

授权类请求/应答报文
预授权请求/应答
预授权撤销（联机、手工）请求/应答
汇款验证请求/应答
MOTO预授权请求/应答
MOTO预授权撤销（联机、手工）请求/应答
账户验证请求/应答
建立/解除委托关系

0200/0210  

金融类请求/应答报文
余额查询请求/应答
取现请求/应答
预授权完成（请求）请求/应答
预授权完成撤销请求/应答
MOTO预授权完成请求/应答
MOTO预授权完成撤销请求/应答

消费请求/应答
消费撤销请求/应答
MOTO消费请求/应答
MOTO消费撤销请求/应答
汇款请求/应答
代收请求/应答
代收撤销请求/应答
贷记请求/应答
基于UICS借贷记标准的IC卡圈存交易请求/应答
基于UICS借贷记标准的现金充值请求/应答

0220/0230 

金融通知/应答类报文
预授权完成（通知）通知/应答
结算通知/应答
退货（联机）通知/应答
MOTO退货（联机）通知/应答
MOTO预授权完成（通知）通知/应答
MOTO结算通知/应答
贷记确认通知/应答
代授权交易联机传输通知/应答

0420/0430  

冲正类通知/应答报文
预授权冲正通知/应答
预授权撤销（联机、手工）冲正通知/应答
取现冲正通知/应答
消费冲正通知/应答
消费撤销冲正通知/应答
预授权完成冲正通知/应答
预授权完成撤销冲正通知/应答
MOTO预授权冲正通知/应答
MOTO预授权撤销（联机、手工）冲正通知/应答
MOTO预授权完成冲正通知/应答
MOTO预授权完成撤销冲正通知/应答
MOTO消费冲正
MOTO消费撤销冲正
代收冲正通知/应答
代收撤销冲正通知/应答
建立委托/解除委托关系冲正通知/应答
基于UICS借贷记标准的现金充值冲正/应答

##### 双信息交易报文

0100/0110  

授权类请求/应答报文
授权请求/应答
授权撤销请求/应答
余额查询请求/应答
MOTO授权请求/应答

MOTO授权撤销请求/应答
代收授权请求/应答
代收授权撤销请求/应答

0220/0230  

金融通知/应答类报文
0420/0430  

冲正类通知/应答
授权冲正通知/应答
授权撤销冲正通知/应答
冲正交易的代授权通知/应答
MOTO授权冲正/应答
MOTO授权撤销冲正/应答
代收授权冲正/应答
代收撤销授权冲正/应答

##### 其它报文

0620/0630  

管理类通知/应答报文
可疑欺诈交易通知/应答
代授权参数信息通知/应答
0800/0810 

网络管理类请求/应答报文
CUPS重置密钥请求/应答
0820/0830  

网络管理类通知/应答报文
CUPS发送网络管理通知/应答
入网机构发送网络管理通知/应答
入网机构申请重置密钥通知/应答
代授权状态检测/应答
代授权交易联机传输（启动、停止）/应答
0600/0610 

银联卡汇率查询



### 位图

报文中使用位图来标识报文中有哪些域而没有哪些域。
一个报文中可以有一个或两个位图位图在报文中位置如图所示：

位图一：2-64
位图二：66-128

第一个位图又称为主位图，每一个报文都有主位图。它由64个二进制位(8个字节)构成，位于报文
类型标识符之后。除了第一位，每一位和一个域相对应，即和域2到域64相对应。其中，需要注意的是，
位图一中的55域专用于IC卡交易，即，若位图一中出现了55域，说明这是一个IC卡交易。每位的值指示
该域是否出现在报文中：
如果一个位为0，与之对应的域不出现在报文中；
如果一个位为1，与之对应的域出现在报文中。
域号是1的域不存在。主位图的第一位用来指明在主位图后是否还有第二个位图，称为拓展位图

### 报文格式

##### 报文结构说明

联机交易报文包含四个组成部分，依次是：报文头、报文类型标识符、位图和报文域。


##### 符号约定

发送方：

AC  受理方(Acquirer)

SW  CUPS（CUPS）

IS  发卡方(Issuer)

SD  报文发送方(Sender)

RC  报文接收方(Receiver)

OB  转账交易的受理方（Original Bank）

CB  转入方或转出方(Cardhold Bank)


数据元数值符号

M  必须填写的域

C  某条件成立时必须填写的域

C+  某条件成立时增加的域

C-  某条件成立时删除的域

M+  必须增加的域

O  受理方和发卡方自选填写的域

  转发域

必须与先前报文中对应域的值相同的域

00  自定义数据元中须填充0的域


##### 数据类型

字符  含义

a

字母字符，A至Z，a至z，向左靠，右边多余位填空格

b

数据的二进制表示，后跟数字表示位（bit）的个数

B

用于表示变长的二进制数，后跟数字表示二进制数据所占字节（Byte）的个数

n

数值，0至9，右靠，首位有效数字前填零。若表示人民币金额，则最右二位为角、分

p

填充字符，如空格

s

特殊符号

an

字母和数字字符，左靠，右边多余位填空格

as

字母和特殊字符，左靠，右边多余位填空格

cn

压缩数字码，即BCD码

ns
数字和特殊字符，左靠，右边多余位填空格

ans

字母、数字和特殊字符，左靠，右边多余位填空格

ansb

字母、数字、特殊字符和二进制数，左靠，右边多余位填空格

MM

月份，01至12

DD

日期，01至31

YY

年份，00至99

hh

时，00至23

mm

分，00至59

ss

秒，00至59

LL

后面跟随数据元的可变长度值，01至99

LLL

后面跟随数据元的可变长度值，001至999

VAR

可变长度数据元

3

3字符的固定长度

..17

最大17个字符的可变长度。所有可变长度字段在数据元的前面应另外包含2个或3个位置，
以表示后面到数据元结束时的位置数。

X

借贷符号，贷记为“C”，借记为“D”，并且总是与一个数字型金额数据元相连，例如，
净对账金额中X+N16含义为前缀“C”或“D”和净对账金额的16位数字。

Z

ISO 4909和ISO 7813中定义的磁卡第二、三磁道的代码集



##### 128域名简介





##### 银联卡跨境交易报文接口定义

###### 余额查询

查询交易用于查询银行卡账面余额或可用余额。
本交易不引发冲正。
当CUPS不能将查询请求转发给发卡方时，将直接拒绝该请求。
当CUPS不能将应答转发给受理方时，将直接丢弃。
当受理方接收不到CUPS的应答时，将直接拒绝该交易。

